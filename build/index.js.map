{"version":3,"sources":["../src/index.js"],"names":["Process","assert","isPromise","channels","call","callback","error","state","rmListeners","emitter","is","Object","values","forEach","removeAllListeners","channel","IpcFlux","options","env","type","Promise","actions","mutations","getters","config","undefined","keys","length","instance","_committing","_actions","create","_mutations","_getters","_subscribers","_config","maxListeners","debug","actionEmitHandler","event","arg","actionExists","action","target","getCurrentWindow","id","act","dispatch","payload","then","sender","send","data","process","mutationEmitHandler","mutationExists","mutation","commit","emitterCallListener","callType","setMaxListeners","on","err","Error","message","console","warn","log","dispatchExternal","commitExternal","resolve","reject","listener","removeListener","registerAction","registerMutation","registerGetter","getter","Boolean","_caller","_action","_payload","entry","all","map","handler","_target","fromId","webContents","_type","_options","_withCommit","sub","_mutation","Array","isArray","push","cb","res","raw","fn","committing"],"mappings":"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","file":"index.js","sourcesContent":["//\n//     _                  _____\n//    (_)__  ____  ____  / _/ /_ ____ __\n//   / / _ \\/ __/ /___/ / _/ / // /\\ \\ /\n//  /_/ .__/\\__/       /_//_/\\_,_//_\\_\\\n//   /_/\n//\n//\tipc-flux\n//\n//\tgithub - https://github.com/harryparkdotio/ipc-flux\n//\tnpm - https://www.npmjs.com/package/ipc-flux\n//\n//\t@harryparkdotio - harry@harrypark.io\n//\n//\tMIT license\n//\n//\n\nimport { ipcMain, ipcRenderer, webContents, remote } from 'electron';\n\nimport utils from './utils';\n\nconst { Process, assert, isPromise } = utils;\n\n// predefined channels\nconst channels = {\n\tcall: 'IpcFlux-Call',\n\tcallback: 'IpcFlux-Callback',\n\terror: 'IpcFlux-Error',\n\tstate: 'IpcFlux-State'\n};\n\n// remove all existing IpcFlux listeners\nconst rmListeners = () => {\n\tconst emitter = Process.is('main') ? ipcMain : ipcRenderer;\n\n\tObject.values(channels).forEach(channel => {\n\t\temitter.removeAllListeners(channel);\n\t});\n};\n\nclass IpcFlux {\n\tconstructor(options = {}) {\n\t\tif (Process.env.type() !== 'production') {\n\t\t\t// check if Promises can be used\n\t\t\tassert(typeof Promise === 'undefined', 'Promises are required');\n\t\t}\n\n\t\t// remove IpcFlux listeners\n\t\trmListeners();\n\n\t\tconst { actions = {}, mutations = {}, getters = {}, config = {} } = options;\n\n\t\tlet { state } = options;\n\n\t\tassert((state !== undefined || (typeof state === 'object' && Object.keys(state).length > 0)) && Process.is('renderer'), 'initial state must be declared in main process');\n\n\t\tif (Process.is('main')) {\n\t\t\tstate = state || {};\n\t\t}\n\n\t\t// defined due to `this` being reassigned in arrow functions (grr)\n\t\tconst instance = this;\n\n\t\tthis._committing = false;\n\t\tthis._actions = Object.create(null);\n\t\tthis._mutations = Object.create(null);\n\t\tthis._getters = Object.create(null);\n\t\tthis._subscribers = [];\n\n\t\tthis._config = Object.create(null);\n\n\t\tthis._config = {\n\t\t\tmaxListeners: 50,\n\t\t\tdebug: false,\n\t\t\t...config\n\t\t};\n\n\t\t// the listener to be called for actions\n\t\tconst actionEmitHandler = (event, arg) => {\n\t\t\tif (instance.actionExists(arg.action)) {\n\t\t\t\tconst target = Process.is('renderer') ? remote.getCurrentWindow().id : arg.target;\n\n\t\t\t\tconst act = dispatch.call(instance, { ...arg, target }, arg.action, arg.payload);\n\n\t\t\t\tif (isPromise(act)) {\n\t\t\t\t\t// on Promise complete, send a callback to the dispatcher\n\t\t\t\t\tact.then(data => {\n\t\t\t\t\t\tevent.sender.send(channels.callback, {\n\t\t\t\t\t\t\t...arg,\n\t\t\t\t\t\t\ttarget,\n\t\t\t\t\t\t\tdata\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t// send a callback to the dispatcher\n\t\t\t\t\tevent.sender.send(channels.error, `[IpcFlux] '${arg.action}' action called from ${arg.process} process, in ${Process.type()} process, did not return a Promise`);\n\t\t\t\t\tevent.sender.send(channels.callback, {\n\t\t\t\t\t\t...arg,\n\t\t\t\t\t\ttarget\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// if the action doesn't exist, send an error message back to the caller\n\t\t\t\tevent.sender.send(channels.error, `[IpcFlux] unknown action called from ${arg.process} process, in ${Process.type()} process: ${arg.action}`);\n\t\t\t}\n\t\t};\n\n\t\tconst mutationEmitHandler = (event, arg) => {\n\t\t\tif (instance.mutationExists(arg.mutation)) {\n\t\t\t\tconst target = Process.is('renderer') ? remote.getCurrentWindow().id : arg.target;\n\n\t\t\t\tcommit.call(instance, { ...arg, target }, arg.mutation, arg.payload);\n\t\t\t}\n\t\t};\n\n\t\t// run on `channel.call`\n\t\tconst emitterCallListener = (event, arg) => {\n\t\t\tif (typeof arg !== 'object') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tswitch (arg.callType) {\n\t\t\t// if the call type is an action, let `actionEmitHandler` handle it\n\t\t\tcase 'action':\n\t\t\t\tactionEmitHandler(event, arg);\n\t\t\t\tbreak;\n\t\t\tcase 'mutation':\n\t\t\t\tmutationEmitHandler(event, arg);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t\t}\n\t\t};\n\n\t\t// define the process emitter, minimizes code duplication\n\t\tconst emitter = Process.is('main') ? ipcMain : ipcRenderer;\n\n\t\temitter.setMaxListeners(this._config.maxListeners);\n\n\t\t// the emitter event handlers for calls and errors\n\t\temitter.on(channels.call, emitterCallListener);\n\n\t\temitter.on(channels.error, (event, err) => {\n\t\t\tif (typeof err === 'object') {\n\t\t\t\tswitch (err.type) {\n\t\t\t\tcase 'throw':\n\t\t\t\t\tthrow new Error(err.message);\n\t\t\t\tcase 'warn':\n\t\t\t\t\tconsole.warn(err.message);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'warning':\n\t\t\t\t\tconsole.warn(err.message);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'log':\n\t\t\t\t\tconsole.log(err.message);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.error(err.message);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.error(err);\n\t\t\t}\n\t\t});\n\n\t\tconst { dispatch, dispatchExternal, commit, commitExternal } = this;\n\n\t\tthis.dispatch = (type, payload) => {\n\t\t\treturn dispatch.call(instance, {\n\t\t\t\tprocess: Process.type(),\n\t\t\t\ttarget: Process.is('renderer') ? remote.getCurrentWindow().id : 0\n\t\t\t}, type, payload);\n\t\t};\n\n\t\tthis.dispatchExternal = (target, action, payload) => {\n\t\t\t// return a promise of the dispatch, resolving on callback\n\t\t\tdispatchExternal.call(instance, target, action, payload);\n\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t// only resolve if the action callback is the same as that called, then remove the callback handler\n\t\t\t\tconst listener = (event, arg) => {\n\t\t\t\t\tif (Process.is('renderer') ? arg.action === target : arg.action === action) {\n\t\t\t\t\t\temitter.removeListener(channels.callback, listener);\n\t\t\t\t\t\tresolve(arg.data);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject();\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\t// setup a callback listener\n\t\t\t\temitter.on(channels.callback, listener);\n\t\t\t});\n\t\t};\n\n\t\tthis.commit = (mutation, payload, options) => {\n\t\t\tcommit.call(instance, mutation, payload, options);\n\t\t};\n\n\t\tthis.commitExternal = (target, mutation, payload, options) => {\n\t\t\t// return a promise of the dispatch, resolving on callback\n\t\t\tcommitExternal.call(instance, target, mutation, payload, options);\n\t\t};\n\n\t\t// register all actions defined in the class constructor options\n\t\tObject.keys(actions).forEach(action => {\n\t\t\tthis.registerAction(action, actions[action]);\n\t\t});\n\n\t\t// register all mutations defined in the class constructor options\n\t\tObject.keys(mutations).forEach(mutation => {\n\t\t\tthis.registerMutation(mutation, mutations[mutation]);\n\t\t});\n\n\t\t// register all getters defined in the class constructor options\n\t\tObject.keys(getters).forEach(getter => {\n\t\t\tthis.registerGetter(getter, getters[getter]);\n\t\t});\n\n\t\tthis.debug = {\n\t\t\tprocess: Process.type(),\n\t\t\tchannels\n\t\t};\n\t}\n\n\tactionExists(action) {\n\t\treturn Boolean(this._actions[action]);\n\t}\n\n\tmutationExists(mutation) {\n\t\treturn Boolean(this._mutations[mutation]);\n\t}\n\n\tdispatch(_caller, _action, _payload) {\n\t\tconst { action, payload } = {\n\t\t\taction: _action,\n\t\t\tpayload: _payload\n\t\t};\n\n\t\tconst entry = this._actions[action];\n\n\t\t// if no action was found\n\t\tif (!entry) {\n\t\t\t// action was dispatched from this process, show the error in this process\n\t\t\tif (_caller.process === Process.type()) {\n\t\t\t\tconsole.error(`[IpcFlux] unknown action: ${action}`);\n\t\t\t}\n\t\t\t// action existence is checked in `actionListener` above, as we don't know the actions defined in the other process\n\t\t\treturn;\n\t\t}\n\n\t\t// return a promise of the action function\n\t\treturn entry.length > 1 ? Promise.all(entry.map(handler => handler(payload))) : entry[0](payload);\n\t}\n\n\tdispatchExternal(_target, _action, _payload) {\n\t\t// same for both process types\n\t\tconst arg = {\n\t\t\tprocess: Process.type(),\n\t\t\tcallType: 'action'\n\t\t};\n\n\t\tlet { target, action, payload } = {\n\t\t\ttarget: _target,\n\t\t\taction: _action,\n\t\t\tpayload: _payload\n\t\t};\n\n\t\tif (Process.is('main')) {\n\t\t\t// checks target is an instance of BrowserWindow, or if is a BrowserWindow id\n\t\t\tif (typeof target !== 'object' && typeof target !== 'number') {\n\t\t\t\tconsole.error('[IpcFlux] target passed is not instanceof BrowserWindow or an active BrowserWindow\\'s id');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// converts BrowserWindow or BrowserWindow id to webContents for instance checking\n\t\t\ttarget = typeof target === 'number' ? webContents.fromId(target) : target.webContents;\n\n\t\t\tif (!target.webContents) {\n\t\t\t\tconsole.error('[IpcFlux] target passed is not an instanceof BrowserWindow or an active BrowserWindow\\'s id');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (typeof action !== 'string') {\n\t\t\t\tconsole.error('[IpcFlux] action not passed as parameter');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\twebContents.fromId(target.webContents.id).send(channels.call, {\n\t\t\t\t...arg,\n\t\t\t\taction,\n\t\t\t\tpayload,\n\t\t\t\t// send the target BrowserWindow id for callback and error handling\n\t\t\t\ttarget: target.webContents.id\n\t\t\t});\n\t\t} else if (Process.is('renderer')) {\n\t\t\tif (typeof target !== 'string') {\n\t\t\t\tconsole.error('[IpcFlux] action not passed as parameter');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// send a call to the main process to dispatch the action\n\t\t\tipcRenderer.send(channels.call, {\n\t\t\t\t...arg,\n\t\t\t\taction: target,\n\t\t\t\tpayload: action,\n\t\t\t\t// send the current BrowserWindow id for callback and error handling\n\t\t\t\ttarget: remote.getCurrentWindow().id\n\t\t\t});\n\t\t}\n\t}\n\n\tcommit(_type, _payload, _options) {\n\t\tconst instance = this;\n\n\t\tlet { type, payload, options } = {\n\t\t\ttype: _type,\n\t\t\tpayload: _payload,\n\t\t\toptions: _options\n\t\t};\n\n\t\tconst mutation = { type, payload };\n\t\tconst entry = this._mutations[type];\n\n\t\tif (!entry) {\n\t\t\tconsole.error(`[IpcFlux] unknown mutation type: ${type}`);\n\t\t\treturn;\n\t\t}\n\n\t\tinstance._withCommit(() => {\n\t\t\tentry.forEach(handler => {\n\t\t\t\thandler(payload);\n\t\t\t});\n\t\t});\n\n\t\tthis._subscribers.forEach(sub => sub(mutation, this.state));\n\t}\n\n\tcommitExternal(_target, _mutation, _payload, _options) {\n\t\tconst instance = this;\n\n\t\tconst arg = {\n\t\t\tprocess: Process.type(),\n\t\t\tcallType: 'mutation'\n\t\t};\n\n\t\tlet { target, mutation, payload, options } = {\n\t\t\ttarget: _target,\n\t\t\tmutation: _mutation,\n\t\t\tpayload: _payload,\n\t\t\toptions: _options\n\t\t};\n\n\t\tif (Process.is('main')) {\n\t\t\tif (typeof target !== 'object' && typeof target !== 'number') {\n\t\t\t\tconsole.error('[IpcFlux] target passed is not instanceof BrowserWindow or an active BrowserWindow\\'s id');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttarget = typeof target === 'number' ? webContents.fromId(target) : target.webContents;\n\n\t\t\tif (!target.webContents) {\n\t\t\t\tconsole.error('[IpcFlux] target passed is not an instanceof BrowserWindow or an active BrowserWindow\\'s id');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (typeof mutation !== 'string') {\n\t\t\t\tconsole.error('[IpcFlux] mutation not passed as parameter');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\twebContents.fromId(target.webContents.id).send(channels.call, {\n\t\t\t\t...arg,\n\t\t\t\tmutation,\n\t\t\t\tpayload,\n\t\t\t\toptions,\n\t\t\t\t// send the target BrowserWindow id for callback and error handling\n\t\t\t\ttarget: target.webContents.id\n\t\t\t});\n\t\t} else if (Process.is('renderer')) {\n\t\t\tif (typeof target !== 'string') {\n\t\t\t\tconsole.error('[IpcFlux] mutation not passed as parameter');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// send a call to the main process to dispatch the action\n\t\t\tipcRenderer.send(channels.call, {\n\t\t\t\t...arg,\n\t\t\t\tmutation: target,\n\t\t\t\tpayload: mutation,\n\t\t\t\toptions: payload,\n\t\t\t\t// send the current BrowserWindow id for callback and error handling\n\t\t\t\ttarget: remote.getCurrentWindow().id\n\t\t\t});\n\t\t}\n\t}\n\n\tregisterAction(action, handler) {\n\t\tconst instance = this;\n\n\t\t// checks if action is in `_actions` array, if not, create an array at the required key\n\t\tconst entry = Array.isArray(instance._actions[action]) ? instance._actions[action] : instance._actions[action] = [];\n\n\t\t// add the action to the array\n\t\t// note that this allows actions to be created using the same action_name, but with different handlers without being overwritten\n\t\tentry.push((payload, cb) => {\n\t\t\t// add the handler to `_actions`, passing in { dispatch, dispatchExternal } for use within the action, as well as the payload and callback\n\t\t\tlet res = handler({\n\t\t\t\tdispatch: instance.dispatch,\n\t\t\t\tdispatchExternal: instance.dispatchExternal\n\t\t\t}, payload, cb);\n\n\t\t\t// if not already a Promise, make it one\n\t\t\tif (!isPromise(res)) {\n\t\t\t\tres = Promise.resolve(res);\n\t\t\t}\n\n\t\t\treturn res;\n\t\t});\n\t}\n\n\tregisterMutation(mutation, handler) {\n\t\tconst instance = this;\n\n\t\tconst entry = Array.isArray(instance._mutations[mutation]) ? instance._mutations[mutation] : instance._mutations[mutation] = [];\n\t\tentry.push((payload) => {\n\t\t\thandler.call(instance, instance.state, payload);\n\t\t});\n\t}\n\n\tregisterGetter(getter, raw) {\n\t\tconst instance = this;\n\n\t\tif (this._getters[getter]) {\n\t\t\tconsole.log('[IpcFlux] duplicate getter key');\n\t\t\treturn;\n\t\t}\n\n\t\tthis._getters[getter] = () => {\n\t\t\treturn raw(instance.state, instance.getters);\n\t\t};\n\t}\n\n\t_withCommit(fn) {\n\t\tconst committing = this._committing;\n\t\tthis._committing = true;\n\t\tfn();\n\t\tthis._committing = committing;\n\t}\n}\n\nexport default IpcFlux;"]}